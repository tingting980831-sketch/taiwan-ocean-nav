import streamlit as st
import xarray as xr
import numpy as np
import matplotlib.pyplot as plt
import cartopy.crs as ccrs
import cartopy.feature as cfeature

# --- 1. ç³»çµ±åˆå§‹åŒ–èˆ‡è¨˜æ†¶åŠŸèƒ½ ---
st.set_page_config(page_title="HELIOS å°ç£è¡›æ˜Ÿå°èˆªç›£æ§ç³»çµ±", layout="wide")

# ä¿ç•™å®šä½ï¼šç´€éŒ„èˆ¹éš»èˆ‡çµ‚é»ä½ç½®
if 'curr_lon' not in st.session_state:
    st.session_state.curr_lon = 121.850 # åŸºéš†å¤–æµ·
if 'curr_lat' not in st.session_state:
    st.session_state.curr_lat = 25.150
if 'dest_lon' not in st.session_state:
    st.session_state.dest_lon = 122.300 # é è¨­ç›®æ¨™
if 'dest_lat' not in st.session_state:
    st.session_state.dest_lat = 25.150

# --- 2. å´é‚Šæ¬„ï¼šå°ˆæ¥­æ§åˆ¶å° ---
st.sidebar.header("ğŸ§­ HELIOS å°èˆªæ§åˆ¶ä¸­å¿ƒ")

# å®šä½æ¨¡å¼
loc_mode = st.sidebar.radio("å®šä½æ¨¡å¼", ["ç«‹å³å®šä½ (GPS æ¨¡æ“¬)", "æ‰‹å‹•è¼¸å…¥åº§æ¨™"])

if loc_mode == "ç«‹å³å®šä½ (GPS æ¨¡æ“¬)":
    st.sidebar.info(f"ğŸ“ GPS å³æ™‚åº§æ¨™:\nLon: {st.session_state.curr_lon:.3f}\nLat: {st.session_state.curr_lat:.3f}")
    c_lon, c_lat = st.session_state.curr_lon, st.session_state.curr_lat
else:
    c_lon = st.sidebar.number_input("æ‰‹å‹•è¨­å®šç¶“åº¦", value=st.session_state.curr_lon, format="%.3f")
    c_lat = st.sidebar.number_input("æ‰‹å‹•è¨­å®šç·¯åº¦", value=st.session_state.curr_lat, format="%.3f")
    st.session_state.curr_lon, st.session_state.curr_lat = c_lon, c_lat

# çµ‚é»è¨­å®š
st.sidebar.markdown("---")
st.sidebar.subheader("ğŸ¯ ä»»å‹™çµ‚é»è¨­å®š")
d_lon = st.sidebar.number_input("ç›®æ¨™ç¶“åº¦", value=st.session_state.dest_lon, format="%.3f")
d_lat = st.sidebar.number_input("ç›®æ¨™ç·¯åº¦", value=st.session_state.dest_lat, format="%.3f")
st.session_state.dest_lon, st.session_state.dest_lat = d_lon, d_lat
